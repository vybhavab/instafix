<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaFix - Image Aspect Ratio Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #fileInput {
            display: none;
        }

        .controls {
            display: none;
        }

        .controls.active {
            display: block;
        }

        .canvas-container {
            display: none;
        }

        .canvas-container.active {
            display: block;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">InstaFix</h1>
            <p class="text-gray-600">Adjust images for any aspect ratio</p>
        </div>

        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8">
            <!-- Upload Area -->
            <div id="uploadArea" class="border-2 border-dashed border-gray-300 rounded-xl p-12 text-center cursor-pointer hover:border-gray-400 hover:bg-gray-50 transition-all">
                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <p class="text-lg font-medium text-gray-900 mb-1">Click to upload or drag and drop</p>
                <p class="text-sm text-gray-500">PNG, JPG, or GIF</p>
                <input type="file" id="fileInput" accept="image/*" capture="environment">
            </div>

            <!-- Controls -->
            <div class="controls mt-8 space-y-6" id="controls">
                <!-- Aspect Ratio -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2">Aspect Ratio</label>
                    <select id="aspectRatio" class="w-full rounded-lg border-gray-300 border px-4 py-2.5 text-gray-900 focus:ring-2 focus:ring-gray-900 focus:border-transparent outline-none transition-all">
                        <option value="1:1">Square (1:1) - Instagram Post</option>
                        <option value="4:5">Portrait (4:5) - Instagram Post</option>
                        <option value="1.91:1">Landscape (1.91:1) - Instagram Post</option>
                        <option value="9:16">Story (9:16) - Instagram Story/Reels</option>
                        <option value="16:9">Landscape (16:9) - YouTube</option>
                    </select>
                </div>

                <!-- Mode -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-3">Mode</label>
                    <div class="flex gap-3">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" id="modePad" name="mode" value="pad" checked class="peer sr-only">
                            <div class="border-2 border-gray-300 rounded-lg px-4 py-3 text-center peer-checked:border-gray-900 peer-checked:bg-gray-900 peer-checked:text-white transition-all">
                                <span class="font-medium">Add Padding</span>
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" id="modeCrop" name="mode" value="crop" class="peer sr-only">
                            <div class="border-2 border-gray-300 rounded-lg px-4 py-3 text-center peer-checked:border-gray-900 peer-checked:bg-gray-900 peer-checked:text-white transition-all">
                                <span class="font-medium">Crop to Fit</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Padding Color -->
                <div id="colorControls">
                    <label class="block text-sm font-medium text-gray-900 mb-3">Padding Color</label>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="color" value="#FFFFFF" checked class="peer sr-only">
                            <div class="border-2 border-gray-300 rounded-lg px-4 py-3 flex items-center gap-3 peer-checked:border-gray-900 transition-all">
                                <div class="w-6 h-6 rounded border-2 border-gray-300 bg-white"></div>
                                <span class="font-medium text-gray-900">White</span>
                            </div>
                        </label>

                        <label class="cursor-pointer">
                            <input type="radio" name="color" value="#000000" class="peer sr-only">
                            <div class="border-2 border-gray-300 rounded-lg px-4 py-3 flex items-center gap-3 peer-checked:border-gray-900 transition-all">
                                <div class="w-6 h-6 rounded bg-black"></div>
                                <span class="font-medium text-gray-900">Black</span>
                            </div>
                        </label>

                        <label class="cursor-pointer">
                            <input type="radio" name="color" value="#F3F4F6" class="peer sr-only">
                            <div class="border-2 border-gray-300 rounded-lg px-4 py-3 flex items-center gap-3 peer-checked:border-gray-900 transition-all">
                                <div class="w-6 h-6 rounded bg-gray-100 border border-gray-300"></div>
                                <span class="font-medium text-gray-900">Gray</span>
                            </div>
                        </label>

                        <label class="cursor-pointer">
                            <input type="radio" name="color" value="blur" class="peer sr-only">
                            <div class="border-2 border-gray-300 rounded-lg px-4 py-3 flex items-center gap-3 peer-checked:border-gray-900 transition-all">
                                <div class="w-6 h-6 rounded bg-gradient-to-br from-gray-400 to-gray-600"></div>
                                <span class="font-medium text-gray-900">Blur</span>
                            </div>
                        </label>

                        <label class="cursor-pointer col-span-2 sm:col-span-1">
                            <input type="radio" name="color" id="customColorRadio" value="custom" class="peer sr-only">
                            <div class="border-2 border-gray-300 rounded-lg px-4 py-3 flex items-center gap-3 peer-checked:border-gray-900 transition-all">
                                <input type="color" id="customColor" value="#1F2937" class="w-6 h-6 rounded cursor-pointer border-0">
                                <span class="font-medium text-gray-900">Custom</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="flex gap-3 pt-4">
                    <button id="processBtn" class="flex-1 bg-gray-900 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-800 transition-all">
                        Process Image
                    </button>
                    <button id="resetBtn" class="px-6 py-3 rounded-lg font-medium border-2 border-gray-300 text-gray-700 hover:bg-gray-50 transition-all">
                        Reset
                    </button>
                </div>
            </div>

            <!-- Canvas Container -->
            <div class="canvas-container mt-8" id="canvasContainer">
                <canvas id="canvas" class="w-full rounded-lg shadow-sm border border-gray-200"></canvas>
                <div class="mt-6 text-center">
                    <button id="downloadBtn" class="bg-gray-900 text-white px-8 py-3 rounded-lg font-medium hover:bg-gray-800 transition-all inline-flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                        Download Image
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let originalImage = null;
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const controls = document.getElementById('controls');
        const canvasContainer = document.getElementById('canvasContainer');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const aspectRatioSelect = document.getElementById('aspectRatio');
        const processBtn = document.getElementById('processBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const colorControls = document.getElementById('colorControls');
        const customColor = document.getElementById('customColor');
        const customColorRadio = document.getElementById('customColorRadio');

        // Upload area click
        uploadArea.addEventListener('click', () => fileInput.click());

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-gray-400', 'bg-gray-50');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-gray-400', 'bg-gray-50');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-gray-400', 'bg-gray-50');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                loadImage(file);
            }
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                loadImage(file);
            }
        });

        // Custom color input
        customColor.addEventListener('click', (e) => {
            e.stopPropagation();
            customColorRadio.checked = true;
        });

        customColor.addEventListener('input', () => {
            customColorRadio.checked = true;
        });

        // Mode change
        document.querySelectorAll('input[name="mode"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                colorControls.style.display = e.target.value === 'pad' ? 'block' : 'none';
            });
        });

        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    originalImage = img;
                    controls.classList.add('active');
                    canvasContainer.classList.remove('active');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function parseAspectRatio(ratio) {
            const [w, h] = ratio.split(':').map(Number);
            return w / h;
        }

        function processImage() {
            if (!originalImage) return;

            const mode = document.querySelector('input[name="mode"]:checked').value;
            const targetRatio = parseAspectRatio(aspectRatioSelect.value);

            if (mode === 'crop') {
                cropImage(targetRatio);
            } else {
                padImage(targetRatio);
            }

            canvasContainer.classList.add('active');
        }

        function cropImage(targetRatio) {
            const imgRatio = originalImage.width / originalImage.height;
            let sourceX = 0, sourceY = 0, sourceWidth = originalImage.width, sourceHeight = originalImage.height;

            if (imgRatio > targetRatio) {
                // Image is wider than target, crop sides
                sourceWidth = originalImage.height * targetRatio;
                sourceX = (originalImage.width - sourceWidth) / 2;
            } else {
                // Image is taller than target, crop top/bottom
                sourceHeight = originalImage.width / targetRatio;
                sourceY = (originalImage.height - sourceHeight) / 2;
            }

            // Set canvas to target ratio with max width of 1080 (Instagram max)
            const maxWidth = 1080;
            canvas.width = maxWidth;
            canvas.height = maxWidth / targetRatio;

            ctx.drawImage(
                originalImage,
                sourceX, sourceY, sourceWidth, sourceHeight,
                0, 0, canvas.width, canvas.height
            );
        }

        function padImage(targetRatio) {
            const imgRatio = originalImage.width / originalImage.height;
            const maxWidth = 1080;
            let canvasWidth, canvasHeight, imgWidth, imgHeight, x, y;

            if (imgRatio > targetRatio) {
                // Image is wider, fit to width
                canvasWidth = maxWidth;
                canvasHeight = maxWidth / targetRatio;
                imgWidth = maxWidth;
                imgHeight = maxWidth / imgRatio;
                x = 0;
                y = (canvasHeight - imgHeight) / 2;
            } else {
                // Image is taller or same, fit to height
                canvasHeight = maxWidth / targetRatio;
                canvasWidth = maxWidth;
                imgHeight = canvasHeight;
                imgWidth = canvasHeight * imgRatio;

                if (imgWidth > canvasWidth) {
                    imgWidth = canvasWidth;
                    imgHeight = canvasWidth / imgRatio;
                }

                x = (canvasWidth - imgWidth) / 2;
                y = (canvasHeight - imgHeight) / 2;
            }

            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            // Get selected color
            const selectedColor = document.querySelector('input[name="color"]:checked').value;

            if (selectedColor === 'blur') {
                // Create blurred background
                ctx.filter = 'blur(20px)';
                ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
                ctx.filter = 'none';

                // Add semi-transparent overlay
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            } else {
                // Solid color background
                const bgColor = selectedColor === 'custom' ? customColor.value : selectedColor;
                ctx.fillStyle = bgColor;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            // Draw original image on top
            ctx.drawImage(originalImage, x, y, imgWidth, imgHeight);
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'instafix-' + Date.now() + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function reset() {
            originalImage = null;
            controls.classList.remove('active');
            canvasContainer.classList.remove('active');
            fileInput.value = '';
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        processBtn.addEventListener('click', processImage);
        downloadBtn.addEventListener('click', downloadImage);
        resetBtn.addEventListener('click', reset);
    </script>
</body>
</html>
